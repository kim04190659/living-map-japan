# 可視化仕様（G-3：Before / After）

本ドキュメントは、都市再編シミュレーション（G）において  
**人間が結果を理解・判断するための可視化設計**を定義する。

可視化は説得のためではない。  
**誤判断を防ぐための減速装置**である。

---

## 1. 可視化の目的

### 唯一の目的
> 差分が「どこで」「何を」「どの程度」変えるのかを直感的に理解させる

### 明確にしないこと
- 正解・不正解
- 採用すべき案
- 優劣順位

---

## 2. 入力データ

### 2.1 必須
- cities.json（Before）
- diff.json（After 差分）

### 2.2 禁止
- diff.json 単体表示
- After-only 表示

👉 **必ず Before を基準にする**

---

## 3. 表示モード（最低限）

### 3.1 Before モード
- 現行の都市構造
- layer による色分け
- 役割（primaryRole）の表示

### 3.2 After（差分）モード
- Before を薄く表示
- 差分のみを強調表示

---

## 4. 差分の表現ルール

### 4.1 layer 変更
- 色の変化を「アニメーションなし」で表示
- 変更前 → 変更後を並列表現

例：
広域コア → 準拠点

yaml
コードをコピーする

### 4.2 role 変更
- 旧 role を打ち消し線
- 新 role を補足文として表示

### 4.3 riskFlag
- 色ではなく「アイコン＋説明文」
- 危険度（low / medium / high）を明示

👉 **赤一色にしない**

---

## 5. 地図UI設計（Leaflet想定）

### 5.1 Marker 表現
- Before：通常色
- After：枠線付き or 点線

### 5.2 重なり防止
- 差分がある都市のみ強調
- 変化のない都市は背景化

---

## 6. 情報密度制御（重要）

### 6.1 初期表示
- 地図のみ
- テキスト最小限

### 6.2 クリック時
- 都市単体の Before / After 比較
- 差分理由（reason）の表示

---

## 7. 全体警告の扱い（systemWarnings）

- 地図上には直接表示しない
- サイドパネル or 下部に集約

例：
- 「国家コア機能が過度に集中しています」
- 「代替不能性が1都市に偏っています」

👉 **個別都市の責任に見せない**

---

## 8. 判断支援UI（非自動）

以下は「ボタン」ではなく「視点切替」とする。

- シナリオ切替
- 表示レイヤ切替
- 危険種別フィルタ

❌ 「適用」「確定」ボタンは禁止

---

## 9. 実装上の原則

- 差分は state として重ねる
- cities.json を直接 mutate しない
- diff.json は read-only

---

## 10. この可視化が果たす役割

このUIは、
- 政策を決めない
- 結論を出さない
- 正義を語らない

ただ一つ、
**「変えた結果を、誤魔化さずに見せる」**

それが G-3 の存在理由である。

